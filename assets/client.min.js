(async()=>{function t(t){return new Promise((n=>setTimeout(n,t)))}var n;n=displayChatMsg,displayChatMsg=(t,e)=>{const i=t[0];return"entertown"!==e.s&&i.setAttribute("data-ts",e.ts),n(t,e)};const e=new class{constructor(){this.baseURL="https://margokantor.pl:2222/api/",this.session=localStorage.getItem("tucz_session"),this.socket=null,this.oldMessages=[],this.charList=null,this.guestChars=null,this.isGuestChars=!1,this.guestID=null,this.ownerID=null,this.oldBattles=[],this.online=0,this.onlineSM=[],this.ranking={},this.rankingClans={},this.tipFocus="out",this.logs=[],this.initLoaded=!1,this.addonLoaded=!1,this.initGuestChars=!1,this.aid=getCookie("user_id")}async inits(){const n=Date.now();if(this.styleInits||this.loadStyles(),!this.session)return this.log("Nie znaleziono sessji w dodatkach."),this.showLoginForm();const e=await this.getSession();if(e.error)return localStorage.removeItem("tucz_session");for(this.charList=e.charList,this.ownerID=e.owner,e.guest&&(this.log(`Wykryto zastępce do reloggera ${e.guestID}.`),this.guestChars=e.guest,this.guestID=e.guestID);g?.init<2;)this.log("Czekam na załadowanie init1."),await t(50);for(this.connectSocket();!this.socket?.connected||!this.initLoaded;)this.log("Czekam na połączenie z socketem."),await t(50);if(!this.socket?.connected)return this.showAlert("Nie udało się połączyc z dodatkami. #1");await this.waitForGame(),this.initGFunction(),await this.waitForChat(),this.loadOldMessages(),this.createRelogger(),setTimeout((()=>{this.addonLoaded=!0}),2e3),this.log(`Załadowano dodatek w ${Date.now()-n}ms.`),console.info(`%c ${this.logs.join("\n")}`,"color: #bada55")}log(t){let n=`${(new Date).getMilliseconds()}`;this.logs.length>50&&this.logs.shift(),this.logs.push(`[${n}] ${t}`)}sortChars(t,n){var e=[];for(var i in t){if(t.hasOwnProperty(i))(r={})[i]=t[i],r.tempSortName=t[i][n].toLowerCase(),e.push(r)}e.sort((function(t,n){var e=t.tempSortName,i=n.tempSortName;return e>i?1:e<i?-1:0}));for(var s=[],o=0,a=e.length;o<a;o++){var r=e[o];for(var i in delete r.tempSortName,r)if(r.hasOwnProperty(i))var c=i;var l=r[c];s.push(l)}return s}async findEq(t){let n={method:"GET"},e=`https://mec.garmory-cdn.cloud/pl/orvidia/${t%128}/${t}.json`;try{const t=await fetch(`${e}`,n);return await t.json()}catch(t){return{}}}async createNewBattle(t,n){const e=Object.keys(t.team1)[0],i=Object.keys(t.team2)[0],s=t.team1[e],o=t.team2[i];let a=s.winner?s:o;const r=$(`<div class='tucz-battle-box'>\n        <div class="tucz-pvp-info">\n        <div class="tucz-player ${s.winner?"tucz-winner-t":"tucz-losser"}">${s.name} </div>\n        <div class="tucz-vs"><div class="${s.winner?"tucz-winner-t":"tucz-losser"}">(${s.lvl}${s.prof})</div> <b>VS</b> <div class="${o.winner?"tucz-winner-t":"tucz-losser"}">(${o.lvl}${o.prof})</div></div>\n        <div class="tucz-player ${o.winner?"tucz-winner-t":"tucz-losser"}"> ${o.name}</div>\n        </div>\n      </div>`),c=$('<div id="tucz-winner"></div>');let l=`<b>${a.name}</b>${a.lvl}${a.prof}`;a.clan&&(l+=`<i>${a.clan}</i>`),c.css({backgroundImage:`url('${a.icon}')`});let d={1:s.eq,2:o.eq};const p={1:{},2:{}},u=[1,3,4,2,6],h=[7,5,14,21];for(let t in d)for(let n in d[t]){const e=d[t][n];let i="none";e.stat.includes("legendary")&&(i="legendary"),e.stat.includes("upgraded")&&(i="upgraded"),e.stat.includes("heroic")&&(i="heroic"),e.stat.includes("unique")&&(i="unique");let s=e.cl;u.includes(e.cl)&&(s="weapon"),h.includes(e.cl)&&(s="secondWeapon");const o=parseItemStat(e.stat);let a=!1;o.enhancement_upgrade_lvl&&(a=`<div class='tucz-enchant'>${o.enhancement_upgrade_lvl}</div>`),p[t][s]=`\n            <div class="tucz-${i} tucz-item" tip='${itemTip(e)}' ctip="t_item">\n              <img src='https://micc.garmory-cdn.cloud/obrazki/itemy/${e.icon}' class="tucz-eq-img"/>\n              ${a||""}\n            </div>`}const g=$(`<div class="tucz-eq" id="tucz-meno">\n        <div class="tucz-eq-${e}" id="eq1">\n         <b class="${s.winner?"tucz-winner-t":"tucz-losser"}">${s.name} (${s.lvl}${s.prof})\n      </b>\n        <div class="first-eq tucz-e">\n         ${p[1][9]||'<div class="tucz-item"></div>'}\n        </div>\n        <div class="second-eq tucz-e">\n        ${p[1][12]||'<div class="tucz-item"></div>'}\n        ${p[1][13]||'<div class="tucz-item"></div>'}\n        ${p[1][11]||'<div class="tucz-item"></div>'}\n        </div>\n        <div class="third-eq tucz-e">\n         ${p[1].weapon||'<div class="tucz-item"></div>'}\n        ${p[1][8]||'<div class="tucz-item"></div>'}\n        ${p[1].secondWeapon||'<div class="tucz-item"></div>'}\n        </div>\n        <div class="fourth-eq tucz-e">\n         ${p[1][10]||'<div class="tucz-item"></div>'}\n        </div>\n        </div>\n        <b class="tucz-v">VS</b>\n        <div class="tucz-eq-${i}" id="eq2">\n        <b class="${o.winner?"tucz-winner-t":"tucz-losser"}">${o.name} (${o.lvl}${o.prof})\n      </b>\n        <div class="first-eq tucz-e">\n        ${p[2][9]||'<div class="tucz-item"></div>'}\n        </div>\n        <div class="second-eq tucz-e">\n        ${p[2][12]||'<div class="tucz-item"></div>'}\n        ${p[2][13]||'<div class="tucz-item"></div>'}\n        ${p[2][11]||'<div class="tucz-item"></div>'}\n        </div>\n        <div class="third-eq tucz-e">\n        ${p[2].weapon||'<div class="tucz-item"></div>'}\n        ${p[2][8]||'<div class="tucz-item"></div>'}\n        ${p[2].secondWeapon||'<div class="tucz-item"></div>'}\n        </div>\n        <div class="fourth-eq tucz-e">\n        ${p[2][10]||'<div class="tucz-item"></div>'}\n        </div>\n        </div>\n      </div>`);$(g).hide(),$(g).mouseenter(((t,n)=>{"tucz-eq"===t.currentTarget.className&&(this.tipFocus="tip")})),$(g).mouseleave(((t,n)=>{"tucz-eq"===t.currentTarget.className&&"tip"!==t.relatedTarget.id&&setTimeout((()=>{$(g).stop().fadeOut(200)}),200),$("#tip").css({display:"none"}),this.tipFocus="out"})),$(c).mouseover((()=>{setTimeout((()=>{$(g).stop().fadeIn(200)}),200)})),$(c).mouseleave((()=>{setTimeout((()=>{"out"===this.tipFocus&&$(g).stop().fadeOut(200)}),200)})),$(r).append(g),$(r).append(c),n?(r.css({opacity:"0",marginTop:"-100px",position:"absolute"}),document.querySelectorAll(".tucz-battle-box").length>0&&document.querySelectorAll(".tucz-battle-box").forEach(((t,n)=>{3==n&&$(t).animate({opacity:0},300),$(t).animate({left:"+=125px"},500)})),setTimeout((()=>{r.prependTo("#tucz-last-battle").animate({marginTop:"4px",opacity:"1"},500,(()=>{const t=document.querySelectorAll(".tucz-battle-box").length;t>4&&document.querySelectorAll(".tucz-battle-box")[t-1].remove(),r.css({position:"relative"}),document.querySelectorAll(".tucz-battle-box").forEach(((t,n)=>{0!==n&&$(t).css({left:"0px"})}))}))}),510)):r.prependTo("#tucz-last-battle")}hideRightPanel(){"3px"!==$("#tucz-right-bar").css("right")?(localStorage.setItem("tucz-right",!1),$("#tucz-right-bar").animate({right:"3px"},1e3)):(localStorage.removeItem("tucz-right",!1),$("#tucz-right-bar").animate({right:"-124px"},1e3))}createLastBattleBar(){const t={w:"Wojownik",m:"Mag",b:"Tancerz ostrzy",h:"Łowca",t:"Tropiciel",p:"Paladyn"},n=$('<div id="tucz-top-bar"></div>'),e=$(`<div id="tucz-right-bar">\n             <div class="tucz-online" tip="Pokaż moderatorów online <img src='https://margokantor.pl/obrazki/left-click.png'>">\n             <div class="online-img">\n                <span class="tucz-online-value">${this.online}</span>\n                <span class="tucz-online-sm-value">${this.onlineSM.length}</span>\n            </div>\n            </div>\n             <div class="tucz-ranking-players"></div>\n             <div class="tucz-ranking-clans"></div>\n             <div class="tucz-arrow"></div>\n        </div>`);$("#centerbox2").append(n),$("#centerbox2").append(e);for(let n in this.ranking){const e=this.ranking[n],i=$(`<div class="tucz-rank">\n                <b class="tucz-${n}">${e.char.nickname}</b>\n                <div class="tucz-fragi">${e.char.lvl} ${t[e.char.prof]} - ${e.points} <div class="tucz-sword" tip="Zwyciężone walki"></div></div>\n        </div>`);i.appendTo(".tucz-ranking-players"),i.click((()=>{window.open(`https://www.margonem.pl/profile/view,${e.char.profileID}#char_${e.char.id},orvidia`,"_blank")})),i.attr("tip","Kliknij aby pokazać profil.")}for(let t in this.rankingClans){const n=this.rankingClans[t];$(`<div class="tucz-rank">\n                <b class="tucz-${t}">${n.clanName}</b>\n                <div class="tucz-fragi">Zabójst - ${n.points} <div class="tucz-sword" tip="Fragi klanu."></div></div>\n        </div>`).appendTo(".tucz-ranking-clans")}localStorage.getItem("tucz-right")&&$("#tucz-right-bar").css({right:"3px"}),$(".tucz-arrow").click((()=>this.hideRightPanel()));const i=this.onlineSM.map((t=>`<div class='tucz-sm' onClick="chatTo('${t}','')">@${t}</div>`));$(".tucz-online").click((()=>{this.showAlert(`\n          Moderatorzy online na świecie:<br>\n          ${i.join("\n")}\n        `)}))}createRelogger(){$("#tucz-reloger").remove();const t=$("<div id='tucz-reloger'></div>"),n=$('<img id="tucz-guest-btn" src="https://margokantor.pl/obrazki/ttt.png">');n.attr("tip","Pokaż postacie zastępcy."),n.click((()=>{$(".tucz-char").fadeOut(500),n.addClass("rotate360"),this.isGuestChars=!this.isGuestChars,setTimeout((()=>this.createRelogger()),500)})),+getCookie("user_id")!==this.guestID||this.initGuestChars||(this.initGuestChars=!0,this.isGuestChars=!0),this.guestID&&t.append(n);let e=this.sortChars(this.charList,"lvl").reverse();this.isGuestChars&&(e=this.sortChars(this.guestChars,"lvl").reverse());for(let n in e){const i=e[n],s=$(`<div class='tucz-char' ctip="t_other" tip="<b>${i.nickname}</b>${i.lvl}${i.prof}"></div>`),o=$('<div class="tucz-char-img" ></div>'),a=$(`<div class="tucz-char-text gfont" name="${i.lvl}${i.prof}">${i.lvl}${i.prof}</div>`);o.css("background-image",`url(${i.image})`),o.css("width","32px"),o.css("height","48px"),s.append(o),s.append(a),t.append(s),s.click((()=>{this.isGuestChars?this.relog(i.id,this.guestID):this.relog(i.id,this.ownerID)}))}$(t).prependTo("#tucz-top-bar")}createLastBattlesElement(){let t=Date.now();this.log("Rozpoczynam ładowanie ostatni walk.");const n=$("<div id='tucz-last-battle'></div>");$("#tucz-top-bar").append(n);for(let t in this.oldBattles)this.createNewBattle(this.oldBattles[t],!1);this.log(`Załadowano ostatnie walki w ${Date.now()-t}ms.`)}async relog(t,n){let e,i=new Date;if(i.setTime(i.getTime()+2592e6),t==hero.id)return message("Jesteś zalogowany na tej postaci!");e=1===hero.guest?"https://www.margonem.pl/ajax/logout":"https://www.margonem.pl/ajax/loginSubstitute",n==getCookie("user_id")&&(deleteCookie("mchar_id"),deleteCookie("user_id"),setCookie("user_id",n,i,"/","margonem.pl"),setCookie("mchar_id",t,i,"/","margonem.pl"),location.reload()),fetch(e,{body:"h2="+getCookie("hs3")+"&security=true",method:"POST",mode:"no-cors",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},credentials:"include"}).then((()=>{deleteCookie("user_id"),deleteCookie("mchar_id"),setCookie("user_id",n,i,"/","margonem.pl"),setCookie("mchar_id",t,i,"/","margonem.pl"),location.reload()}))}connectSocket(){let t=Date.now();$.getScript("https://cdn.socket.io/4.4.1/socket.io.min.js",(async()=>{this.log(`Wczytano bibliotekę socket.io w ${Date.now()-t}ms`),this.socket=io.connect("wss://margokantor.pl:2222/orvidia",{query:{user_id:getCookie("user_id"),session:this.session,guest:hero.guest||0,char:hero.id,nickname:hero.nick}}),this.socket.on("newMessage",(t=>t.error?this.showAlert(t.error):t.profile?this.showProfileAction(t):void this.writeNewMessage(t))),this.socket.on("getChat",(t=>{if(t.error)return this.showAlert(t.error);this.oldMessages=t;for(let t in this.oldMessages)this.writeNewMessage(this.oldMessages[t]),delete this.oldMessages[t]})),this.socket.on("online",(t=>{this.online=t.usersOnline,this.onlineSM=t.connectSM,0!==$(".tucz-online-value").length&&($(".tucz-online-value").text(t.usersOnline),$(".tucz-online-sm-value").text(t.connectSM.length))})),this.socket.on("exit",(t=>{message(t.message)})),this.socket.on("newBattle",(t=>{t.team1&&this.createNewBattle(t,!0)})),this.socket.on("info",(t=>{t.error&&this.showAlert(t.error,!0)})),this.socket.on("inits",(t=>{if(t.error)return this.showAlert(t.error);this.oldMessages=t.chatMessages,this.oldBattles=t.lastBattles,this.ranking=t.rankingInits,this.rankingClans=t.rankingInitsClans,this.initLoaded=!0})),this.socket.on("info",(t=>{if(t.message)return this.showAlert(t.message)}))}))}loadOldMessages(){const t=Date.now();this.log("Rozpoczynam ładowanie chatu globalnego.");for(let t in this.oldMessages)this.writeNewMessage(this.oldMessages[t]),delete this.oldMessages[t];this.sortMessages(),this.createLastBattlesElement(),this.log(`Załadowano chat globalny w ${Date.now()-t}ms.`)}async writeNewMessage(t){let n=[];n.push(t),newChatMsg(n)}async waitForGame(){try{for(;g?.init<5;)this.log("Czekam na załadowanie init 4."),await t(50)}catch{return await this.waitForGame()}this.createLastBattleBar()}sortMessages(){let t=$("#chattxt div");t.sort((function(t,n){return $(t).data("ts")-$(n).data("ts")})),$("#chattxt").html(t)}async waitForChat(){try{for(;g?.init<4;)this.log("Czekam na załadowanie init 3."),await t(50)}catch{return await this.waitForChat()}oneChatMsg=t=>{const n="3433518";var e=$("<div>"),i=$("<span>"),s=parseChatText(t),o=getChatStyleMsg(t),a=getChatInfoMsg(t);if($(s).html().includes('class="link"')){const n=t.t.split(" ").find((t=>t.includes("http")||t.includes("http")||t.includes("www"))),e=t.t.split("//")[1]?.split("/")[0],i=$(`<u id='tucz-link' onclick="goToUrl('${n}')">[Zły link]</u>`);$(s).html(""),i.text(`[${e}]`),$(s).append(i)}if(4===t.k&&s.addClass("global"),4==t.k&&"System"!==t.n&&t.created_id!=n){const n=$("<span>");n.css({"margin-left":"0.5px","margin-right":"0.5px"}),n.addClass("global"),4===t.permission&&n.text("[SM]"),32===t.permission&&n.text("[MC]"),4!==t.permission&&n.text("[G]"),n.appendTo(e)}if(1===t.guest&&"System"!==t.n){const t=$("<span>");t.attr("tip","Zastępca zalogowany."),t.css({"margin-left":"0.5px","margin-right":"0.5px"}),t.text("[Z]"),t.appendTo(e)}if(t.created_id==n&&4===t.k&&"System"!==t.n){const t=$("<span>");t.attr("tip","Twórca dodatków globalnych."),t.css({"margin-left":"0.5px","margin-right":"0.5px","margin-top":"-0.5px",color:"#ce1414"}),i.css({color:"#ce1414"}),t.text("[D]"),t.appendTo(e)}if("System"==t.n&&4===t.k){const t=$("<span>");t.attr("tip","System dodatków globalnych."),t.text("[S]"),t.appendTo(e),s.css({color:"rgb(255 247 0)",fontWeight:300}),i.css({color:"#00BCD4",fontWeight:300})}if(e.append(i),e.append(s),e.addClass(o),i.text(a),0==g.chat.tab&&isset(t.fr)&&1==t.fr&&i.addClass("fr"),""!=t.n&&"System"!=t.n){var r=t.n;r==hero.nick&&isset(t.nd)&&(r=t.nd),i.addClass("chnick"),i.attr("tip",ut_time(t.ts)),i.attr("c_nick",r)}return displayChatMsg(e,t),e},updateChatLastMsg=()=>{if(null!==g.chat.lastMsg&&!g.chat.write){var t=["",_t("[K]",null,"chat"),_t("[G]",null,"chat"),_t("[P]",null,"chat"),""],n=$("<div>");n.attr("id","lastmsg");var e=document.createTextNode(t[g.chat.lastMsg.kind]);n.append(e),n.append(g.chat.lastMsg.$el.children().clone()),$("#bottxt").empty().append(n),g.chat.write||$("#lastmsg").fadeIn()}},newChatMsg=t=>{var n=3==g.chat.state?255:500,e=[];for(var i in t)e[parseInt(i)]=t[i];if(g.ch=e,e[0].ts>g.chat.ts||4==e[0].k){for(var s=[],o=e[e.length-1].n==hero.nick,a=e.length-1;a>=0;a--){var r=e[a];hasIgnoreChatMsg(r)||(g.chat.lastMsg={kind:r.k,$el:oneChatMsg(r)},3==r.k&&r.n!=hero.nick&&"System"!=r.n&&(g.chat.lastnick=r.n),o||(s[r.k]=!0))}chatScroll(-1),updateChatLastMsg(),updateChatNewMsg(s)}chatScrollbar("chattxt",n,"chatscrollbar")},displayChatMsg=(t,n)=>{const e=t[0];"entertown"!==n.s&&e.setAttribute("data-ts",n.ts),4==g.chat.tabs.length&&4==n.k&&(g.chat.tabs.push([]),g.chat.tabs[n.k].push(t)),0!=n.k&&g.chat.tabs[0].push(t.clone(!0,!0)),n.ts>g.chat.ts&&4!=n.k&&(g.chat.ts=n.ts),n.k!=g.chat.tab&&0!=g.chat.tab||$("#chattxt").append(t.clone(!0,!0))}}async getSession(){const t=await this.baseRequest("getSession",{user_id:getCookie("user_id"),session:this.session});return this.log(`Pobrano getSession w ${t.ping}ms.`),t.slow?this.showAlert(t.slow):(t.error&&this.showAlert(t.error),t)}async sendNewMessage(t){if(!this.socket)return!1;this.socket.emit("newMessage",{nickname:hero.nick,user_id:getCookie("user_id"),message:t,session:this.session,permission:hero.uprawnienia})}loadStyles(){$("#ni-promo").remove(),$("head").append("<style>.alert-box {\n            width: 400px !important;\n            height: auto !important;\n            position: relative;\n        }\n        .tucz-eq-img {\n         width: 25px;\n         height: 25px;\n         object-fit: cover;\n        }\n       .tucz-top-1 {\n    color: #ffd700b0 !important;\n}\n.tucz-top-2 {\n    color: #9b9a99b0 !important;\n}\n.tucz-top-3 {\n    color: #a35201b0 !important;\n}\n        #tucz-gurnik {\n    height: 100%;\n    display: flex;\n    width: 100%;\n    justify-content: space-evenly;\n    align-items: center;\n    z-index: 1002;\n    background: red;\n        }\n          .tucz-e {\n       display: flex;\n       justify-content: center;\n          }\n          .tucz-upgraded  {\n    -webkit-box-shadow: 0px 0px 5px 1px #eafb08;\n    box-shadow: inset 0px 0px 5px 1px #eafb08;\n}\n\n.tucz-unique {\n    -webkit-box-shadow: 0px 0px 5px 1px #918817;\n    box-shadow: inset 0px 0px 5px 1px #918817;\n}\n.tucz-heroic {\n    -webkit-box-shadow: inset 0px 0px 5px 1px #177491;\n    box-shadow: inset 0px 0px 5px 1px #177491;\n}\n.tucz-legendary {\n    -webkit-box-shadow: inset 0px 0px 5px 1px #ff123b;\n    box-shadow: inset 0px 0px 5px 1px #ff123b;\n}\n        .tucz-item {\n         width: 25px;\n         height: 25px;\n         background: #2020208c;\n         border: 1px solid #282828;\n         margin: 1px;\n         position: relative;\n        }\n        .tucz-enchant {\n    position: absolute;\n    bottom: 0px;\n    font-size: 10px;\n    background: #00000063;\n    border-radius: 8px;\n    left: 1px;\n    color: #9d9090;\n    font-family: arial;\n}\n        .char-t {\n          margin-bottom: 6px !important;\n        }\n        .tucz-u b {\n        color: #df5d00;\n        }\n        .tucz-btn {\n            margin-left: 0px !important;\n        }\n        .tucz-kill {\n        margin-bottom: 0px !important;\n        height: 30px;\n        }\n        .tucz-select {\n         color: #4bdf00;\n        }\n        .tucz-action input[type=\"number\"] {\n         width: 25px;\n         left: 2px;\n         border: none;\n        }\n        .tucz-online {\n         width: 100%;\n         height: 50px;\n         position: absolute;\n         display: flex;\n         align-items: center;\n         justify-content: center;\n         font-size: 13px;\n        }\n        .tucz-sm {\n            position: relative;\n            color: #af4545;\n            cursor: pointer;\n            margin-bottom: 1px !important;\n            margin-top: 10px !important;\n        }\n        .tucz-online-value {\n        position: absolute;\n        right: 0;\n        color: #b9b9b9;\n        background: #050e03ba;\n         padding: 2px;\n        border-radius: 8px;\n        bottom: 0px;\n        text-align: center;\n        }\n        .tucz-online-sm-value {\n        position: absolute;\n        left: 0;\n        color: #e30000;;\n        background: #050e03ba;\n         padding: 2px;\n        border-radius: 8px;\n        bottom: 0px;\n        text-align: center;\n        }\n        .online-img {\n            width: 32px;\n            height:32px;\n            position: absolute;\n            z-index: 99;\n            background-image: url('https://margokantor.pl/obrazki/online.png');\n            -webkit-background-size: cover;\n            -moz-background-size: cover;\n            -o-background-size: cover;\n             background-size: cover;\n             object-fit: cover;\n             cursor:pointer;\n        }\n        .tucz-rank {\n            font-size: 10px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        .tucz-rank b{\n            color: #059f34b8;\n            font-size: 11px;\n            cursor: pointer;\n        }\n        .tucz-ranking-players {\n            width: 116px;\n            height: 220px;\n         position: absolute;\n         top: 100px;\n         right: 7px;\n        }\n        .tucz-ranking-clans {\n            width: 116px;\n         height: 220px;\n         position: absolute;\n         top: 378px;\n         right: 7px;\n        }\n        .tucz-battle-box {\n            display: flex;\n            flex-direction: row-reverse;\n            margin-left: 11px;\n            width: 114px;\n            height: 50px;           \n            margin-top: 8px;\n            min-width: 114px;\n            margin-bottom: 5px;\n            align-items: center;\n            justify-content: center;\n            position: relative;\n        }\n        .tucz-eq {\n    width: 250px;\n    height: 161px;\n    background: #171817ed;\n    position: absolute;\n    top: -130px;\n    left: 34px;\n    border: 1px solid #636262;\n    z-index: 402;\n    box-shadow: 5px 5px 10px rgb(0 0 0 / 20%);\n    border-radius: 4px;\n    display: flex;\n    justify-content: space-evenly;\n    font-family: Arial;\n    align-items: center;\n        }\n        .tucz-winner-t {\n            color: #34b300;\n        }\n        #eq2 b, #eq1 b {\n         font-size: 10px;\n    margin-top: 7px;\n    display: flex;\n    flex-direction: column;\n    margin-bottom: 10px;\n    width: 100px;\n    height: 10px;\n    word-break: break-word;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n        }\n        .tucz-v {\n         margin-top: 30px;\n    color: gold;\n    font-size: 13px;\n        }\n        .tucz-pvp-info {\n         font-size: 9px;\n            margin-top: 4px;\n            color: #b4b4b4;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            sletter-spacing: 0.1px;\n        }\n        .tucz-vs {\n            padding: 2px;\n            text-align: center;\n            display: flex;\n            font-weight: 600;\n        }\n        .tucz-vs  b {\n           color: #f9c500;\n           margin-right: 5px;\n           margin-left: 5px;\n        }\n        #tucz-winner{\n           width: 25px !important;\n           height: 38px;\n           background-size: 100px;\n           margin-top: 2px;\n        }\n        #tucz-last-battle {\n    width: 50px;\n    height: 50px;\n    display: flex;\n    position: relative;\n    top: 10px;\n    width: 500px;\n    align-items: flex-end;\n        }\n        #tucz-guest-btn {\n            width: 25px !important;\n            height: 25px !important;\n            margin-right: 10px;\n            margin-top: 2px\n            transition: all 1s ease-out;\n        }\n        \n        .alert-box main div {\n           text-align: center;\n           margin-bottom: 20px;\n           font-weight: 100;\n           padding: 5px;\n        }\n        .alert-box button {\n            margin-bottom: 20px;\n        }  \n        .tucz-char-text {\n         position: absolute;\n         margin-top: -15px;\n         font-size: 14px;\n         background: rgba(0,0,0,0.46);\n        }\n        .tucz-data-error {\n    background: #2c2c2c;\n    padding: 10px;\n    margin-top: 20px;\n        }\n        .tucz-char {\n         margin-top: 5px;\n         cursor: pointer;\n          display: flex;\n         flex-direction: column-reverse;\n          align-items: center;\n        }\n        #tucz-reloger {\n         width: 280px;\n         height: 50px;\n         z-index: 402;\n         position: absolute;\n         right: 8px;\n         margin-top: 3px;\n         display: flex;\n         align-items: center;\n         justify-content: flex-start;\n         grid-gap: 6px;\n        }\n        .alert-box {\n    border-radius: 8px;\n    color: #cccccc;\n    font-family: Arial, Helvetica, sans-serif;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 5px 5px 10px rgb(0 0 0 / 20%);\n    margin-bottom: 50px;\n    z-index: 1001;\n    position: absolute;\n    left: calc(50% - 200px);\n    top: calc(50% - 200px);\n        border: 1px solid #605f5e;\n    cursor: grab;\n    background: url(https://margokantor.pl/obrazki/bg.jpg) no-repeat center center fixed;\n    -webkit-background-size: cover;\n    -moz-background-size: cover;\n    -o-background-size: cover;\n    background-size: cover;\n    opacity: 0.99;\n        }    \n        \n        .alert-box:active {\n         cursor: grabbing;\n        }   \n        .tucz-login-form {\n            width: 300px;\n            height: 260px;\n            background: #1f1f1f;\n            border-radius:8px;\n            color: #cccccc;\n            font-family: Arial, Helvetica, sans-serif;\n            display : flex;\n            flex-direction: column;\n            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.199);\n            margin-bottom: 50px;\n            z-index: 1000;\n            position: absolute;\n            left: calc(50% - 150px);\n            top: calc(50% - 130px);\n            border: 1px solid #636262;\n        }\n        .tucz-window header {\n            text-transform: uppercase;\n            font-weight: bold;\n            text-align: center;\n            width: 100%;\n            display:flex;\n            flex-direction: column;\n            align-items: center;\n            margin-bottom: 10px;\n        }\n        .tucz-window header:first-child {\n            margin-top: 8px\n        }\n        .tucz-char {\n        cursor: pointer !important;\n        }\n        .under-header {\n            width: 95%;\n            height: 0.5px;\n            background: #181717;\n            -webkit-box-shadow: 1px 1px 1px 7px #000000;\n            box-shadow: 0px 0px 1px 0.1px #494747;\n            margin-top: 8px;\n        }\n        .tucz-subtitle {\n            position: relative;\n            left: 40px;\n            font-size: 13px;\n            color: rgba(177, 177, 177, 0.3);\n        }\n        .tucz-window main {\n            margin-top: 5px;\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n        }\n        .tucz-window main button:active  {\n         transform: scale(0.9);\n        }\n        .tucz-window main input {\n            border: none;\n            border-bottom: solid rgb(143, 143, 143) 1px;\n            margin-bottom: 30px;\n            background: none;\n            color: rgba(255, 255, 255, 0.555);\n            height: 25px;\n            width: 200px;\n            position: relative;\n            left: 40px;\n            outline: none;\n        }\n        .tucz-window main button {\n            cursor: pointer;\n            border: none;\n            border-radius: 8px;\n            box-shadow: 2px 2px 7px rgba(211, 180, 56, 0.44);\n            background: #b98120;\n            color: rgba(255, 255, 255, 0.8);\n            width: 80%;\n            padding: 5px;\n            transition: all 200ms;\n            outline: none;\n            margin-left: 10%;\n        }\n        .tucz-window bottom b {\n            top: 10px;\n            position: relative;\n            font-size: 11px;\n            color: #a1a0a0;\n        }\n        .tucz-window bottom {\n           text-align: center;\n           width: 100%;\n        }\n        .small-window {\n            height: 190px !important;\n        } \n        .close-windows-ga {\n         position: absolute;\n         right: 20px;\n         cursor: pointer;\n        }\n        .tucz-wait-btn {\n          font-weight: bold;\n          animation: tucz-spin 1s ease-in-out infinite;\n        }\n        .profile-code {\n          text-align: center;\n          background-color: #4b4a48;\n          padding: 10px;\n          margin-bottom: 20px;\n        }\n        .small-info-profile-code {\n         text-align: center;\n         margin-bottom: 20px;\n         font-size: 13px;\n        }\n        .global {\n         color: #00BCD4;\n        }  \n        .rotate360 {\n            transition: transform 500ms;\n            transform: rotate(360deg)\n            }\n        @keyframes tucz-spin {\n            0% {transform:rotate(360deg)}\n        }\n        #tucz-top-bar {\n          width: 800px;\n    height: 60px;\n    position: absolute;\n    z-index: 400;\n    margin-top: -65px;\n    margin-left: -6px;\n    background-image: url(https://margokantor.pl/obrazki/belka_gora.png);\n    -webkit-background-size: cover;\n    -moz-background-size: cover;\n    -o-background-size: cover;\n    background-size: cover;\n    object-fit: cover;\n        } \n        .tucz-fragi {\n         display: flex;\n    color: #9595958c;\n        }\n        .tucz-sword {\n            width: 10px;\n            height:10px;\n            background-image: url('https://margokantor.pl/obrazki/sword.png');\n            -webkit-background-size: cover;\n            -moz-background-size: cover;\n            -o-background-size: cover;\n             background-size: cover;\n             object-fit: cover;\n             margin-left: 5px;\n        } \n        .tucz-arrow {\n             width: 16px;\n         height: 16px;\n         position: absolute;\n         z-index: 402;\n         margin-top: 310px;\n             /* margin-left: -6px; */\n         background-image: url(https://margokantor.pl/obrazki/arrow.png);\n         -webkit-background-size: cover;\n            -moz-background-size: cover;\n         -o-background-size: cover;\n            background-size: cover;\n         object-fit: cover;\n            right: -16px;\n            cursor: pointer;\n            }   \n        #tucz-right-bar {\n               width: 133px;\n    height: 607px;\n    position: absolute;\n    right: -124px;\n    margin-top: -65px;\n    background-image: url(https://margokantor.pl/obrazki/belka_prawo.png);\n    -webkit-background-size: cover;\n    -moz-background-size: cover;\n    -o-background-size: cover;\n    background-size: cover;\n    object-fit: cover;\n    z-index: 200;\n}\n        \n        </style>")}showWaitBtn(){$(".tucz-register").html("<div class='tucz-wait-btn'>☼</div>").prop("disabled",!0),$(".tucz-login").html("<div class='tucz-wait-btn'>☼</div>").prop("disabled",!0)}endWaitBtn(){$(".tucz-register").text("Zarejestruj").prop("disabled",!1),$(".tucz-login").text("Zaloguj").prop("disabled",!1)}showCodeAlert(t,n){$(".alert-box").remove(),$(`<div class="alert-box tucz-window">\n        <header>\n            <b>Uwaga</b>\n            <div class="under-header"></div>\n        </header>\n        <main>\n            <div>${t}</div>\n            <div class="profile-code">${n}</div>\n            <div class="small-info-profile-code">Następnie zamnij okono oraz ponownie przystąp do rejestracji.</div>\n            <button class="alert-close">Zamknij</button>\n        </main>\n       </div>`).appendTo($("body")),$(".alert-box button").click((()=>{$(".alert-box").fadeOut("fast",(()=>{$(".alert-box").remove()}))}))}showProfileAction(n){$(".alert-box").remove(),$(`<div class="alert-box tucz-window">\n        <header>\n            <b>Uwaga</b>\n            <div class="under-header"></div>\n        </header>\n        <main>\n            <div class="tucz-u">Wyszukano: <b>${n.nickname}</b></div>\n            <div class="tucz-mc-chars">\n             \n            </div>\n            <div class="tucz-action">\n            <div class="tucz-kill">Ilość godzin killa: <input type="number" value="24"></div><br>\n            <button class="tucz-btn" id="tucz-s-a">Zaznacz wszystkie</button>\n            <button class="tucz-btn" id="tucz-s-k">Zabij zaznaczone</button>\n            <button class="tucz-btn" id="tucz-s-u" >UnZabij zaznaczone</button>\n            </div>\n            <button class="alert-close">Zamknij</button>\n        </main>\n       </div>`).appendTo($("body"));for(let t in n.charList){const e=n.charList[t],i=$(`<div class='char-t'>\n            <span>${e.nickname}</span>\n        </div>`);i.click((()=>{i.attr("class").includes("tucz-select")?i.removeClass("tucz-select"):i.addClass("tucz-select")})),i.appendTo(".tucz-mc-chars")}$("#tucz-s-a").click((()=>{$(".char-t").each((function(){$(this).addClass("tucz-select")}))})),$("#tucz-s-k").click((async()=>{const n=[];$(".tucz-select span").each((function(){n.push($(this).text())}));for(let e in n)console.log(`/kill ${$(".tucz-kill input").val()} ${n[e]}`),webSocket.send(JSON.stringify({g:`browser_token=${g.browser_token}&ev=${g.ev}&t=chat`,p:JSON.stringify({c:`/kill ${$(".tucz-kill input").val()} ${n[e]}`})})),await t(250)})),$("#tucz-s-u").click((async()=>{const n=[];$(".tucz-select span").each((function(){n.push($(this).text())}));for(let e in n)webSocket.send(JSON.stringify({g:`browser_token=${g.browser_token}&ev=${g.ev}&t=chat`,p:JSON.stringify({c:`/unkill ${n[e]}`})})),await t(250)})),$(".alert-box .alert-close").click((()=>{$(".alert-box").fadeOut("fast",(()=>{$(".alert-box").remove()}))}))}async baseRequest(t,n){let e=Date.now();const i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};try{$(".tucz-window").length>0&&this.showWaitBtn();const n=await fetch(`${this.baseURL}${t}`,i);if($(".tucz-window").length>0&&this.endWaitBtn(),429===n.status)return{slow:"Odczekaj trochę przed kolejną próbą."};let s=await n.json();return s.ping=Date.now()-e,s}catch(t){return $(".tucz-window").length>0&&this.endWaitBtn(),{error:t}}}showLoginForm(){$(".tucz-login-form").remove(),$('<div class="tucz-login-form small-window tucz-window">\n         <header>\n            <b>Logowanie</b>\n            <div class="under-header"></div>\n            <div class="close-windows-ga">X</div>\n        </header>\n        <main>\n            <div class="tucz-subtitle">Podaj hasło:</div>\n            <input id="tucz-login-password" type="password">\n            <button class="tucz-login">Zaloguj</button>\n        </main>\n        <bottom>\n            <b class="bottom-links">Nie posiadasz konta?</b>\n        </bottom>\n       </div>').appendTo($("body")),$(".tucz-login-form .close-windows-ga").click((()=>{this.hideForms()})),$(".tucz-login-form .bottom-links").click((()=>this.showRegisterWindow())),$(".tucz-login").click((()=>this.login()))}async register(){if(""===$("#tucz-password").val())return this.showAlert("Uzupełnij wszystkie pola!");if($("#tucz-password").val()!==$("#tucz-password2").val())return this.showAlert("Podane hasła są różne!");const t=await this.baseRequest("register",{user_id:getCookie("user_id"),password:$("#tucz-password").val(),nickname:hero.nick});return t.slow?this.showAlert(t.slow):t.error?this.showAlert(t.error):t.code?this.showCodeAlert(t.success,t.code):void(t.success&&(this.showAlert(t.success),this.showLoginForm()))}async parseCommand(t){t.includes("/c")&&"/c"===t.substring(0,2)&&this.sendNewMessage(t.replace("/c ","")),"/lock"===t.substring(0,6)&&this.sendNewMessage(t),"/unlock"===t.substring(0,8)&&this.sendNewMessage(t),"/gmute"===t.substring(0,6)&&this.sendNewMessage(t),"/gmenu"===t.substring(0,6)&&("/gmenu"===t&&(t+=` ${g.other[Object.keys(g.other)[0]].nick}`),this.sendNewMessage(t))}async initGFunction(){(t=>{chatSend=(n,e)=>n.includes("/")?this.parseCommand(n):t(n,e)})(chatSend),(t=>{parseInput=(n,e)=>(n.event_done&&this.addonLoaded&&this.socket.emit("getChat"),t(n,e))})(parseInput)}async login(){if(""===$("#tucz-login-password").val())return this.showAlert("Uzupełnij wszystkie pola!");const n=await this.baseRequest("login",{user_id:getCookie("user_id"),password:$("#tucz-login-password").val()});return n.slow?this.showAlert(n.slow):n.error?this.showAlert(n.error):n.code?this.showCodeAlert(n.success,n.code):n.session?(this.session=n.session,localStorage.setItem("tucz_session",n.session),this.hideForms(),await t(1e3),this.inits()):void 0}hideForms(){$(".tucz-login-form").fadeOut("fast",(()=>{$(".tucz-login-form").remove()})),$(".tucz-register-form").fadeOut("fast",(()=>{$(".tucz-register-form").remove()}))}showRegisterWindow(){$(".tucz-login-form").remove(),$('<div class="tucz-login-form tucz-window">\n        <header>\n            <b>Rejestracja</b>\n            <div class="under-header"></div>\n            <div class="close-windows-ga">X</div>\n        </header>\n        <main>\n            <div class="tucz-subtitle">Podaj hasło:</div>\n            <input id="tucz-password" type="password">\n            <div class="tucz-subtitle">Podaj ponownie hasło:</div>\n            <input id="tucz-password2" type="password">\n            <button class="tucz-register">Zarejestruj</button>\n        </main>\n        <bottom>\n            <b class="bottom-links">Posiadasz juz konto?</b>\n        </bottom>\n       </div>').appendTo($("body")),$(".tucz-login-form .close-windows-ga").click((()=>{this.hideForms()})),$(".tucz-login-form .bottom-links").click((()=>this.showLoginForm())),$(".tucz-register").click((()=>this.register()))}showAlert(t){$(".alert-box").remove(),$(`<div class="alert-box tucz-window">\n        <header>\n            <b>Uwaga</b>\n            <div class="under-header"></div>\n        </header>\n        <main>\n            <div>${t}</div>\n            <button class="alert-close">Zamknij</button>\n        </main>\n       </div>`).appendTo($("body")).draggable({containment:"body",start:function(){g.lock.add("alert-box")},stop:function(){g.lock.remove("alert-box")}}),$(".alert-box button").click((()=>{$(".alert-box").fadeOut("fast",(()=>{$(".alert-box").remove()}))}))}};var i;await e.inits(),i=battleMsg,battleMsg=function(t,n){if(t.search("winner=")>-1){const n={};for(let t in g.battle.f)n[t]=g.battle.f[t];e.socket.emit("newBattle",{battle:n,map:map.name,user_id:getCookie("user_id"),session:localStorage.getItem("tucz_session"),nickname:hero.nick,winner:t})}return i(t,n)}})();